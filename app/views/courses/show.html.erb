<%if @course[:webinar] and @course[:from] and @course[:to]%>
<%startDate = DateTime.parse(@course[:from])%>
<%finishDate = DateTime.parse(@course[:to])%>
<%notYet = DateTime.now < startDate%>
<%currentlyGoingOn = DateTime.now > startDate && DateTime.now < finishDate%>
<%ended = !notYet && !currentlyGoingOn %>
<%end%>
<div class="container-fluid course-detail">
  <div class="row">
    <div class="col-xs-12 col-md-9">
		<% if @course[:webinar] and notYet %>
			<%= render partial: "courses/countdown", :locals => { date: startDate} %>
		<% elsif (currentlyGoingOn)%>
			<div class="live">
				<div class="text-center">
					<h2 class="orange"><%=t("course.live")%><img src="<%=@course[:platform_img]%>"/></h2>
					<a href="<%=@course[:url]%>">
						<button class="btn btn-orange"><%=t("course.join")%></button>
					</a>
					<br/>
					<br/>
				</div>
			</div>
		<% elsif @course[:video] %>
    		<iframe class="course-video" src="<%=youtube_parse(@course[:video])%>" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    	<%else%>
    		<img  class="course-video" src="<%=@course[:photo_file_path]%>" alt="">
    	<%end%>
    </div>
    <div class="col-xs-12 col-md-3 course-info">
		<%if user_signed_in? and current_user[:role] == "admin"%>
			<a href="/courses/<%=@course[:id]%>/edit" class="text-right d-block link-edit-course">
				<button class="btn btn-dark orange btn-edit-course">
					<i class="far fa-edit"></i>
				</button>
			</a>
		<%else%>
			<br/>
		<%end%>
		<% if @course[:webinar] %>
			<%if @course[:from]%>
				<div class="course-characteristic">
					<span class="course-field orange"><%= t("course.date")%>:</span> 
					<span><%=@course[:from]%></span> 
				</div>
			<%end%>
			<%if @course[:from] and @course[:to]%>
				<div class="course-characteristic">
					<span class="course-field orange"><%= t("webinar.duration")%>:</span> 
					<%duration = ((DateTime.parse(@course[:to]) - DateTime.parse(@course[:from]))*24*3600).to_i%>
					<span><%=formatted_duration(duration)%></span>
				</div>
			<%end%>
		<% else %>
			<%if @course[:from] and @course[:to]%>
				<div class="course-characteristic">
					<span class="course-field orange"><%= t("course.date")%>:</span>
					<span><%=@course[:from]%>-<%=@course[:to]%></span> 
				</div>
			<% end %>
			<% if @course[:duration] %>
				<div class="course-characteristic">
					<span class="course-field orange"><%= t("course.duration")%>:</span> 
					<span><%=@course[:duration]%></span>
				</div>
			<% end %>
			<% if @course[:type] %>
				<div class="course-characteristic">
					<span class="course-field orange"><%= t("course.type")%>:</span> 
					<span><%=t("course.course_formats." + @course[:type])%></span>
				</div>
			<% end %>
			<% if @course[:lessons] %>
				<div class="course-characteristic">
					<span class="course-field orange"><%= t("course.lessons")%>:</span> 
					<span><%=course[:lessons]%></span>
				</div>
			<% end %>
		<% end %>
		<% if @course[:lang] %>
			<div class="course-characteristic">
				<span class="course-field orange"><%= t("course.languages")%>:</span> 
				<span><%=course[:lang]%></span>
			</div>
		<% end %>
		<% if @course[:tags] %>
			<div class="course-characteristic">
				<span class="course-field orange"><%= t("course.tags")%>:</span> 
				<span>
					<% @course[:tags].each_with_index do |tag, index|%>
						<span class="course-tag"><%=t("tags." + tag)%></span><%if index != @course[:tags].length()-1%>, <%end%> 
					<%end%>
				</span>
			</div>
		<% end %>
		<%if (@course[:powered_by])%>
			<div class="course-characteristic">
				<span class="course-field orange"><%= t("course.powered_by")%>:</span> 
				<span><%=@course[:powered_by]%></span>
			</div>
		<%end%>
		<%if (@course[:rating])%>
			<div class="course-characteristic">
				<span class="course-field orange" ><%= t("course.rating")%>:</span>
				<span class="course-rating-container">
    	   		<%= render partial: "courses/rating", :locals => {rating: @course[:rating]}  %>
    	   		</span>
    	   	</div>
		<%end%>
		
		<br/><br/><br/><br/>
		<% if @course[:webinar] %>
			<br/><br/>
			<a href="<%=@course[:url]%>">
				<%if notYet%>
					<button class="btn btn-orange btn-see" ><%= t("course.enroll_webinar")%></button>
				<%elsif ended%>
					<button class="btn btn-orange btn-see" ><%= t("course.see")%></button>
				<%end%>
			</a>
		<% else %>
			<button class="btn btn-orange btn-see" ><%=@course[:enrolled] ? t("course.continue") : t("course.enroll")%></button>
		<% end %>
		<br/>
    </div>
  </div>
</div>
<div class="container course-desc">
	<div class="row">
	    <div class="col-xs-12 col-lg-9"><br/><br/>
	    	<div>
				<h2 class="orange"><%=@course[:name]%></h2>
				<%if @course[:desc] %>
					<p><%=sanitize @course[:desc].html_safe%></p>
				<% end %>
			</div>
			<%if @course[:contents] and @course[:contents].length() > 0 %>
				<div>
					<h3 class="orange-light"><%= t("course.contents")%>
						<%if @course[:guide_file_name] %>
							<a href="<%=@course[:guide_file_path]%>" download ="<%=@course[:guide_file_name]%>"  class="float-sm-right">
								<button class="btn btn-outline-dark">
									<%= t("course.download_guide")%>&nbsp;&nbsp;<i class="fas fa-download"></i>
								</button>
							</a>
						<% end %>
					</h3>
					<ul class="content-list">
						<% @course[:contents].each do |section|%>
							<li class="content-section">
								<span class="content-title"><%=section[:title]%></span>
								<ul class="topic-list">
									<% section[:topics].each do |topic|%>
										<li class="topic"><span><%=topic%></span>
									<%end%>
								</ul>
						<%end%>
					</ul>
				</div>
			<% end %>
	    	<br/>
	    	<br/>
			<% (@course[:teachers]||[]).each_with_index do |teacher, index| %>
		   		<%= render partial: "courses/teacher_card", :locals => {index: index, teacher: teacher}  %>
			<% end %>
			<br>
		</div>
	</div>
</div>
<div class="soft-background">
  <%= render partial: "courses/course_list_4", 
        :locals => {title: t("course.related_courses"), courses: @related_courses || [], link: "/", mine: false }  %>
</div>